# Пользовательские коллекции

## Обзор, цель и назначение урока

На этом уроке рассматривается работа с пользовательскими коллекциями в Microsoft .NET Framework. Учащимся демонстрируются различные примеры создания пользовательских коллекций, разъясняется работа ключевых интерфейсов:

- `IEnumerable` и `IEnumerator`
- `IEnumerable<T>` и `IEnumerator<T>`
- `ICollection` и `ICollection<T>`
- `IList`

Отдельное внимание уделяется оператору `yield` и циклу `foreach`. Также слушатели познакомятся с концепцией шаблона проектирования **Iterator**.  

**Цели обучения:**  
После изучения материала учащийся сможет:  
- Понимать работу коллекций.  
- Понимать работу оператора `yield` и цикла `foreach`.  
- Эффективно использовать шаблон проектирования Iterator.  
- Создавать собственные коллекции, организовывать эффективную навигацию по их содержимому.

---

## Содержание урока

- Коллекции  
- Интерфейсы `IEnumerable`, `IEnumerator`, `IEnumerable<T>`, `IEnumerator<T>`  
- Работа цикла `foreach`  
- Оператор `yield`  
- Интерфейсы `ICollection` и `ICollection<T>`  
- Создание простой коллекции с помощью реализации интерфейса `IList`  
- Рассмотрение коллекции, созданной с использованием паттерна Iterator  

---

## Резюме

- Коллекция — набор объектов схожих типов.  
- Емкость коллекции — число элементов, которое она может содержать.  
- Количество элементов коллекции — число реально содержащихся элементов.  
- Нижняя граница коллекции — индекс первого элемента.  
- **Перечислитель** — объект, выполняющий итерацию в коллекции (подобно перемещаемому указателю). Может быть несколько перечислителей для одной коллекции. Оператор `foreach` упрощает работу с ними.  
- Оператор `foreach` предполагает одинаковый тип всех элементов коллекции.  
- Все перечислители основаны на интерфейсах `IEnumerator` и `IEnumerable` (или обобщённых `IEnumerator<T>` и `IEnumerable<T>`).  
- Ключевое слово `yield` обозначает блок итератора; компилятор создаёт для него класс.  
- В блоке итератора `yield` используется с `return` для предоставления значения перечислителю.  
- `yield` также используется с `break` для обозначения конца итерации.  
- Интерфейс `ICollection` определяет размер, перечислители и методы синхронизации нестандартных коллекций; `ICollection<T>` — его обобщённый аналог.  
- `ICollection` расширяет интерфейсы `IEnumerable`, `IDictionary` и `IList`.  
- Реализация `IList` позволяет доступ к элементам через индекс (например, как в `ArrayList`).  
- **Iterator** — паттерн поведения, предоставляющий последовательный доступ к элементам объекта без раскрытия его внутреннего представления, поддерживая несколько обходов и единообразный интерфейс для различных структур.

---

## Закрепление материала

- Что такое коллекция?  
- Перечислите члены интерфейсов `IEnumerable`, `IEnumerator`, `IEnumerable<T>`, `IEnumerator<T>`.  
- Что такое оператор `yield`?  
- Опишите алгоритм работы цикла `foreach`.  
- Можно ли использовать оператор `yield` в анонимных методах?  
- В каких случаях применять паттерн Iterator и каково его основное предназначение?

---

## Дополнительное задание

Создайте метод, который принимает массив целых чисел и возвращает коллекцию квадратов всех нечётных чисел массива. Для формирования коллекции используйте оператор `yield`.  

---

## Самостоятельная деятельность учащегося

### Задание 1
Выучите основные конструкции и понятия, рассмотренные на уроке.

### Задание 2
Создайте коллекцию, содержащую наименования 12 месяцев, их порядковый номер и количество дней. Реализуйте выбор месяцев по порядковому номеру и количеству дней (результатом может быть несколько месяцев).  

### Задание 3
Создайте абстрактный класс **Гражданин** и наследников: **Студент**, **Пенсионер**, **Рабочий**.  

Создайте непараметризированную коллекцию с функционалом:  

**Добавление элемента:**  
- Можно добавлять только `Гражданина`.  
- Элемент добавляется в конец коллекции; `Пенсионер` — в начало (с учётом ранее добавленных пенсионеров).  
- Возвращается номер в очереди.  
- Если человек с таким же номером паспорта уже есть — элемент не добавляется, выводится сообщение.  

**Удаление:**  
- С начала коллекции.  
- По переданному экземпляру `Гражданина`.  

**Методы коллекции:**  
- `Contains` — возвращает `true/false` и номер в очереди.  
- `ReturnLast` — возвращает последнего человека и его номер.  
- `Clear` — очищает коллекцию.  
- Поддержка `foreach`.

### Задание 4
Перейдите на сайт MSDN и найдите описание каждой темы, рассмотренной на уроке. Сохраните ссылки и дайте им краткое описание.  

**Рекомендуемые ресурсы:**  
- [Определение коллекций](http://msdn.microsoft.com/ru-ru/library/akyhke97.aspx)  
- [Ключевое слово yield](http://msdn.microsoft.com/ru-ru/library/9k7k7cf0.aspx)  
- [Итераторы](http://msdn.microsoft.com/ru-ru/library/dscyy5s0.aspx)  
- [Управление коллекциями и их создание](http://msdn.microsoft.com/ru-ru/library/14ek9axh.aspx)  
- [Перечисление коллекции](http://msdn.microsoft.com/ru-ru/library/hwyysy67.aspx)  
- [Пространство имен System.Collections](http://msdn.microsoft.com/ru-ru/library/k166wx47.aspx)
